<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>OmniLink â€” Admin Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
body{font-family:Poppins,system-ui;background:#0b0a18;color:#fff;margin:0}
header{display:flex;justify-content:space-between;align-items:center;width:min(1200px,94vw);margin:22px auto}
.badge{width:56px;height:56px;border-radius:16px;display:grid;place-items:center;background:linear-gradient(135deg,#8a5cff,#6a4cff);color:#0b0620;font-weight:900}
.btn{background:linear-gradient(135deg,#8a5cff,#6a4cff);color:#0b0620;border:none;font-weight:700;padding:10px 14px;border-radius:10px;cursor:pointer}
.grid{width:min(1200px,94vw);margin:auto;display:grid;grid-template-columns:1fr 1fr;gap:22px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
.card{background:#18152f;border-radius:16px;padding:18px;box-shadow:0 6px 20px rgba(0,0,0,.3)}
.list > div{padding:8px 0;border-bottom:1px solid #ffffff20}
</style>
</head>
<body>
<header>
  <div style="display:flex;align-items:center;gap:12px">
    <div class="badge">OL</div>
    <h1>Admin Dashboard</h1>
  </div>
  <button class="btn" onclick="logout()">Logout</button>
</header>

<div class="grid">
  <div class="card">
    <h2>ðŸ“ˆ Leads by Day</h2>
    <canvas id="c1" height="200"></canvas>
  </div>
  <div class="card">
    <h2>ðŸ§° Contractors by Service</h2>
    <canvas id="c2" height="200"></canvas>
  </div>
</div>

<div class="card" style="width:min(1200px,94vw);margin:20px auto">
  <h2>Recent Leads</h2>
  <div id="leads" class="list"></div>
</div>

<script>
if(!localStorage.getItem('omni_admin')) location.href='login.html';
function logout(){ localStorage.removeItem('omni_admin'); location.href='login.html'; }

// Prepare data
const leads=JSON.parse(localStorage.getItem('omni_leads')||'[]').slice(-15);
const dayCounts={};
leads.forEach(l=>{
  const d=(l.createdAt||new Date().toISOString()).slice(0,10);
  dayCounts[d]=(dayCounts[d]||0)+1;
})
const labels=Object.keys(dayCounts).sort();
const values=labels.map(d=>dayCounts[d]);

new Chart(document.getElementById('c1'),{
  type:'line',
  data:{labels, datasets:[{data:values, borderColor:'#8a5cff', fill:false}]},
  options:{plugins:{legend:{display:false}}}
});

const cats=JSON.parse(localStorage.getItem('omni_contractors')||'{}');
const svc=Object.keys(cats), cnt=svc.map(s=>cats[s].length);
new Chart(document.getElementById('c2'),{
  type:'bar',
  data:{labels:svc, datasets:[{data:cnt, backgroundColor:'#6a4cff'}]},
  options:{plugins:{legend:{display:false}}, scales:{x:{ticks:{color:'#cfd2ff'}, grid:{display:false}}, y:{grid:{color:'#ffffff14'}}}}
});

leads.reverse();
leadsEl=document.getElementById('leads');
leadsEl.innerHTML = leads.length ? leads.map(l=>(
  `<div><b>${l.service}</b> â€” ${l.area} â€¢ ${new Date(l.createdAt||Date.now()).toLocaleString()}<br>
   ${l.name} â€” ${l.phone}<br>
   Assigned: ${l.contractorName||'Auto'}</div>`
)).join('') : "<div>No recent leads.</div>";
</script>
</body>
</html>
